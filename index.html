<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Language & Passions Questionnaire</title>

  <!-- SurveyJS core + UI -->
  <link rel="stylesheet" href="https://unpkg.com/survey-core/survey-core.min.css">
  <script src="https://unpkg.com/survey-core/survey.core.min.js"></script>
  <script src="https://unpkg.com/survey-js-ui/survey-js-ui.min.js"></script>

  <!-- A modern built-in theme (recommended approach) -->
  <script src="https://unpkg.com/survey-core/themes/layered-light-panelless.min.js"></script>

  <style>
    :root{
      --bg1:#f7f7ff;
      --bg2:#f2fbff;
      --card:#ffffffcc;
      --stroke:#e7e7ee;
      --text:#0f172a;
      --muted:#64748b;
      --shadow: 0 20px 60px rgba(15, 23, 42, .10);
      --radius: 22px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 20% 0%, var(--bg2), transparent 60%),
        radial-gradient(900px 500px at 90% 10%, var(--bg1), transparent 55%),
        linear-gradient(180deg, #ffffff, #fafafa);
      padding: 22px;
    }

    .wrap{ max-width: 980px; margin: 0 auto; }

    header{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:14px;
      margin-bottom: 16px;
    }

    .brand{
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    .brand h1{
      margin:0;
      font-size: clamp(22px, 2.6vw, 34px);
      letter-spacing:-0.02em;
    }

    .brand p{
      margin:0;
      color:var(--muted);
      line-height:1.35;
      max-width: 56ch;
    }

    .pill{
      align-self:flex-start;
      padding: 8px 12px;
      border:1px solid var(--stroke);
      background:#fff;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      box-shadow: 0 8px 24px rgba(15,23,42,.05);
      user-select:none;
    }

    .card{
      background: var(--card);
      backdrop-filter: blur(10px);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
    }

    #surveyContainer{
      margin-top: 4px;
    }

    .status{
      margin-top: 12px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: #fff;
      color: var(--muted);
      font-size: 13px;
      display:none;
    }
    .status.show{ display:block; }
    .status.ok{ border-color:#bbf7d0; background:#f0fdf4; color:#166534; }
    .status.err{ border-color:#fecaca; background:#fef2f2; color:#991b1b; }

    footer{
      margin-top: 14px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.4;
    }

    /* Small screens */
    @media (max-width: 640px){
      body{ padding:14px; }
      .card{ padding:14px; }
      header{ flex-direction:column; align-items:flex-start; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1>Language & Passions</h1>
        <p>
          Add passions → contexts → languages. Fill only what you know, and you can modify anytime before submitting.
        </p>
      </div>
      <div class="pill">Student questionnaire • SurveyJS</div>
    </header>

    <div class="card">
      <div id="surveyContainer"></div>
      <div id="status" class="status"></div>

      <footer>
        Tip: if the page is blank, open DevTools → Console. Most issues are a missing JSON paste or a wrong webhook URL.
      </footer>
    </div>
  </div>

  <!-- ✅ Paste your FULL SurveyJS JSON here (pure JSON, no trailing commas) -->
  <script id="survey-json" type="application/json">
  {
  "title": "Language & Passions Questionnaire",
  "description": "Fill in as many details as you want. You can add multiple passions, contexts, and languages.",
  "completedHtml": "<h3>Thank you!</h3><p><b>Main linguistic profile:</b> {profileTitle}<br/><b>Engagement:</b> {engagement}<br/><b>Modality (derived):</b> {style}</p>",
  "pages": [
    {
      "name": "identity",
      "title": "About you",
      "elements": [
        { "type": "text", "name": "student_full_name", "title": "Full name", "isRequired": true },
        {
          "type": "text",
          "name": "student_email",
          "title": "Email",
          "isRequired": true,
          "inputType": "email",
          "validators": [{ "type": "email" }]
        },
        {
          "type": "dropdown",
          "name": "grade",
          "title": "Grade / Class level",
          "isRequired": true,
          "choices": [
            { "value": "grade6", "text": "Grade 6" },
            { "value": "grade7", "text": "Grade 7" },
            { "value": "grade8", "text": "Grade 8" },
            { "value": "grade9", "text": "Grade 9" },
            { "value": "grade10", "text": "Grade 10" },
            { "value": "grade11", "text": "Grade 11" },
            { "value": "grade12", "text": "Grade 12" },
            { "value": "college", "text": "College / University" },
            { "value": "other", "text": "Other" }
          ]
        },
        {
          "type": "text",
          "name": "age",
          "title": "Age",
          "isRequired": true,
          "inputType": "number",
          "validators": [{ "type": "numeric", "minValue": 5, "maxValue": 99 }]
        }
      ]
    },
    {
      "name": "passions_page",
      "title": "What are your passions?",
      "description": "What languages do you use when engaging in your passions, and in what environnements ?",
      "elements": [
        {
          "type": "paneldynamic",
          "name": "passions",
          "title": "Your passions",
          "panelCount": 1,
          "minPanelCount": 1,
          "panelsState": "firstExpanded",
          "addPanelText": "Add another passion",
          "removePanelText": "Remove this passion",
          "templateTitle": "Passion #{panelIndex}",
          "templateElements": [
            {
              "type": "dropdown",
              "name": "passionItem",
              "title": "1) Choose a passion",
              "isRequired": true,
              "choices": [
                { "value": "read_text", "text": "Reading a text" },
                { "value": "write_stories", "text": "Writing stories" },
                { "value": "draw", "text": "Drawing" },
                { "value": "take_photos", "text": "Taking photos" },
                { "value": "edit_videos", "text": "Editing videos" },
                { "value": "create_online_content", "text": "Creating online content" },
                { "value": "watch_films_series", "text": "Watching films / series" },
                { "value": "watch_tutorials", "text": "Watching tutorials" },
                { "value": "listen_music", "text": "Listening to music" },
                { "value": "sing", "text": "Singing" },
                { "value": "play_instrument", "text": "Playing an instrument" },
                { "value": "listen_podcasts", "text": "Listening to podcasts" },
                { "value": "play_video_games", "text": "Playing video games" },
                { "value": "board_games", "text": "Playing board games" },
                { "value": "phone_calls", "text": "Talking on the phone" },
                { "value": "do_research", "text": "Doing research" },
                { "value": "describe_passion", "text": "Describing your passion" },
                { "value": "role_play", "text": "Role play (theatre)" },
                { "value": "sports", "text": "Doing sports" },
                { "value": "visit_museum", "text": "Visiting a museum" }
              ]
            },
            {
              "type": "text",
              "name": "passionDetail",
              "title": "Optional: clarify / specify your passion",
              "description": "Example: 'reading fantasy novels', 'football', 'editing TikTok videos'..."
            },
            {
              "type": "paneldynamic",
              "name": "contexts",
              "title": "2) Context(s) for this passion",
              "panelCount": 1,
              "minPanelCount": 1,
              "panelsState": "firstExpanded",
              "addPanelText": "Add another context",
              "removePanelText": "Remove this context",
              "templateTitle": "Context #{panelIndex}",
              "templateElements": [
                {
                  "type": "dropdown",
                  "name": "contextItem",
                  "title": "Choose a context",
                  "isRequired": true,
                  "choices": [
                    { "value": "alone_reader", "text": "Alone (reader)" },
                    { "value": "family", "text": "Family" },
                    { "value": "friends", "text": "Friends" },
                    { "value": "school", "text": "School" },
                    { "value": "internet", "text": "Internet" },
                    { "value": "future_work", "text": "Future job" },
                    { "value": "other_country", "text": "Another country" }
                  ]
                },
                { "type": "expression", "name": "ctx_oral_tag", "visible": false, "expression": "iif({panel.contextItem} = 'alone_reader',0, iif({panel.contextItem} = 'family',1, iif({panel.contextItem} = 'friends',1, iif({panel.contextItem} = 'school',0, iif({panel.contextItem} = 'internet',0, iif({panel.contextItem} = 'future_work',0, iif({panel.contextItem} = 'other_country',1,0)))))))" },
                { "type": "expression", "name": "ctx_written_tag", "visible": false, "expression": "iif({panel.contextItem} = 'alone_reader',1, iif({panel.contextItem} = 'family',0, iif({panel.contextItem} = 'friends',0, iif({panel.contextItem} = 'school',1, iif({panel.contextItem} = 'internet',1, iif({panel.contextItem} = 'future_work',1, iif({panel.contextItem} = 'other_country',0,0)))))))" },

                {
                  "type": "paneldynamic",
                  "name": "languages",
                  "title": "3) Language(s) used in this context",
                  "panelCount": 1,
                  "minPanelCount": 1,
                  "panelsState": "firstExpanded",
                  "addPanelText": "Add another language",
                  "removePanelText": "Remove this language",
                  "templateTitle": "Language #{panelIndex}",
                  "templateElements": [
                    {
                      "type": "dropdown",
                      "name": "languageCode",
                      "title": "Language",
                      "isRequired": true,
                      "choices": [
                        { "value": "EN", "text": "English" },
                        { "value": "FR", "text": "French" },
                        { "value": "ES", "text": "Spanish" },
                        { "value": "AR", "text": "Arabic" },
                        { "value": "DE", "text": "German" },
                        { "value": "IT", "text": "Italian" },
                        { "value": "PT", "text": "Portuguese" },
                        { "value": "ZH", "text": "Chinese" },
                        { "value": "JA", "text": "Japanese" },
                        { "value": "KO", "text": "Korean" },
                        { "value": "RU", "text": "Russian" },
                        { "value": "OTHER", "text": "Other (type it)" }
                      ]
                    },
                    { "type": "text", "name": "languageOtherName", "title": "Which language?", "visibleIf": "{panel.languageCode} = 'OTHER'", "isRequired": true },
                    { "type": "text", "name": "years", "title": "How many years have you used this language in this context?", "inputType": "number", "validators": [{ "type": "numeric", "minValue": 0, "maxValue": 99 }] },
                    {
                      "type": "dropdown",
                      "name": "frequency",
                      "title": "Frequency (for this passion in this context)",
                      "choices": [
                        { "value": 0, "text": "Never / almost never" },
                        { "value": 1, "text": "Rarely" },
                        { "value": 2, "text": "Sometimes" },
                        { "value": 3, "text": "Often" },
                        { "value": 4, "text": "Every day" }
                      ]
                    },
                    { "type": "boolean", "name": "wantIncrease", "title": "Want to practice more ?", "labelTrue": "Yes", "labelFalse": "No" },
                    { "type": "expression", "name": "lang_fm", "visible": false, "expression": "iif({panel.languageCode} = 'EN', 0, iif({panel.frequency} empty, 0, {panel.frequency}) + iif({panel.wantIncrease}, 1, 0))" },
                    { "type": "expression", "name": "lang_years_nonEN", "visible": false, "expression": "iif({panel.languageCode} = 'EN' or {panel.years} empty, 0, {panel.years})" }
                  ]
                },

                { "type": "expression", "name": "ctx_fm_total", "visible": false, "expression": "sumInArray({panel.languages}, 'lang_fm')" },
                { "type": "expression", "name": "ctx_years_nonEN", "visible": false, "expression": "sumInArray({panel.languages}, 'lang_years_nonEN')" },
                { "type": "expression", "name": "ctx_family_years_nonEN", "visible": false, "expression": "iif({panel.contextItem} = 'family', sumInArray({panel.languages}, 'lang_years_nonEN'), 0)" },
                { "type": "expression", "name": "ctx_nonEN_lang_entries", "visible": false, "expression": "countInArray({panel.languages}, 'languageCode', {languageCode} <> 'EN' and {years} > 0)" },

                { "type": "expression", "name": "ctx_lang_count", "visible": false, "expression": "countInArray({panel.languages}, 'languageCode', {languageCode} notempty)" },
                { "type": "expression", "name": "ctx_EN_lang_count", "visible": false, "expression": "countInArray({panel.languages}, 'languageCode', {languageCode} = 'EN')" },
                { "type": "expression", "name": "ctx_nonEN_lang_count", "visible": false, "expression": "countInArray({panel.languages}, 'languageCode', {languageCode} <> 'EN' and {languageCode} notempty)" },

                { "type": "expression", "name": "ctx_has_lang", "visible": false, "expression": "iif({panel.ctx_lang_count} > 0, 1, 0)" },
                { "type": "expression", "name": "ctx_oral_context_points", "visible": false, "expression": "{panel.ctx_oral_tag} * {panel.ctx_lang_count}" },
                { "type": "expression", "name": "ctx_written_context_points", "visible": false, "expression": "{panel.ctx_written_tag} * {panel.ctx_lang_count}" }
              ]
            },

            { "type": "expression", "name": "passion_oral_tag", "visible": false, "expression": "iif({panel.passionItem} = 'watch_films_series' or {panel.passionItem}='watch_tutorials' or {panel.passionItem}='listen_music' or {panel.passionItem}='sing' or {panel.passionItem}='play_instrument' or {panel.passionItem}='listen_podcasts' or {panel.passionItem}='board_games' or {panel.passionItem}='phone_calls' or {panel.passionItem}='role_play' or {panel.passionItem}='sports' or {panel.passionItem}='visit_museum', 1, 0)" },
            { "type": "expression", "name": "passion_written_tag", "visible": false, "expression": "iif({panel.passionItem} = 'read_text' or {panel.passionItem}='write_stories' or {panel.passionItem}='draw' or {panel.passionItem}='take_photos' or {panel.passionItem}='edit_videos' or {panel.passionItem}='create_online_content' or {panel.passionItem}='play_video_games' or {panel.passionItem}='do_research' or {panel.passionItem}='describe_passion', 1, 0)" },

            { "type": "expression", "name": "passion_has_lang", "visible": false, "expression": "iif(countInArray({panel.contexts}, 'ctx_has_lang', {ctx_has_lang} = 1) > 0, 1, 0)" },

            { "type": "expression", "name": "passion_lang_count", "visible": false, "expression": "sumInArray({panel.contexts}, 'ctx_lang_count')" },
            { "type": "expression", "name": "passion_EN_lang_count", "visible": false, "expression": "sumInArray({panel.contexts}, 'ctx_EN_lang_count')" },
            { "type": "expression", "name": "passion_nonEN_lang_count", "visible": false, "expression": "sumInArray({panel.contexts}, 'ctx_nonEN_lang_count')" },

            { "type": "expression", "name": "passion_fm_total", "visible": false, "expression": "sumInArray({panel.contexts}, 'ctx_fm_total')" },
            { "type": "expression", "name": "passion_years_nonEN_total", "visible": false, "expression": "sumInArray({panel.contexts}, 'ctx_years_nonEN')" },
            { "type": "expression", "name": "passion_family_years_nonEN", "visible": false, "expression": "sumInArray({panel.contexts}, 'ctx_family_years_nonEN')" },
            { "type": "expression", "name": "passion_max_ctx_years_nonEN", "visible": false, "expression": "maxInArray({panel.contexts}, 'ctx_years_nonEN')" },
            { "type": "expression", "name": "passion_nonEN_context_count", "visible": false, "expression": "countInArray({panel.contexts}, 'ctx_years_nonEN', {ctx_years_nonEN} > 0)" },
            { "type": "expression", "name": "passion_nonEN_lang_entries", "visible": false, "expression": "sumInArray({panel.contexts}, 'ctx_nonEN_lang_entries')" },
            { "type": "expression", "name": "passion_contexts_over5_count", "visible": false, "expression": "countInArray({panel.contexts}, 'ctx_years_nonEN', {ctx_years_nonEN} > 5)" },

            {
              "type": "expression",
              "name": "passion_oral_total",
              "visible": false,
              "expression": "({panel.passion_oral_tag} * {panel.passion_lang_count}) + sumInArray({panel.contexts}, 'ctx_oral_context_points')"
            },
            {
              "type": "expression",
              "name": "passion_written_total",
              "visible": false,
              "expression": "({panel.passion_written_tag} * {panel.passion_lang_count}) + sumInArray({panel.contexts}, 'ctx_written_context_points')"
            }
          ]
        }
      ]
    },
    {
      "name": "results",
      "title": "Your profile (preview)",
      "elements": [
        {
          "type": "html",
          "name": "profile_card",
          "html": "<div style=\"display:flex; gap:16px; align-items:center; padding:12px; border:1px solid #e5e7eb; border-radius:16px;\"><div style=\"flex:0 0 auto;\"><img src=\"{profileImageUrl}\" alt=\"{profileTitle} illustration\" style=\"width:120px; height:auto; border-radius:16px;\"/></div><div style=\"flex:1 1 auto;\"><h3 style=\"margin:0 0 6px 0;\">{profileTitle}</h3><p style=\"margin:0; line-height:1.35;\">{profileDescription}</p></div></div>"
        },
        {
          "type": "expression",
          "name": "show_engagement",
          "title": "Engagement (Active/Passive)",
          "expression": "{engagement} + ' (FM total, non-English only: ' + {fmTotal} + ')'"
        },
        {
          "type": "expression",
          "name": "show_modality",
          "title": "Modality (derived from passions + contexts)",
          "expression": "{style} + ' (oral score: ' + {oralTotal} + ', written score: ' + {writtenTotal} + ')'"
        },
        {
          "type": "boolean",
          "name": "emailMyResults",
          "title": "Do you want to receive your results by email?",
          "defaultValue": true,
          "labelTrue": "Yes, email me my results",
          "labelFalse": "No thanks"
        }
      ]
    }
  ],
  "calculatedValues": [
    { "name": "fmTotal", "expression": "sumInArray({passions}, 'passion_fm_total')", "includeIntoResult": true },
    { "name": "passionCount", "expression": "sumInArray({passions}, 'passion_nonEN_lang_count')", "includeIntoResult": true },
    { "name": "engagement", "expression": "iif({passionCount} >= 4 and {fmTotal} > 12, 'Active', 'Passive')", "includeIntoResult": true },

    { "name": "oralTotal", "expression": "sumInArray({passions}, 'passion_oral_total')", "includeIntoResult": true },
    { "name": "writtenTotal", "expression": "sumInArray({passions}, 'passion_written_total')", "includeIntoResult": true },
    { "name": "diffOralWritten", "expression": "iif({oralTotal} - {writtenTotal} < 0, {writtenTotal} - {oralTotal}, {oralTotal} - {writtenTotal})", "includeIntoResult": true },
    { "name": "style", "expression": "iif({oralTotal} < 2 and {writtenTotal} < 2, 'Subi', iif({diffOralWritten} <= 2, 'Mixed', iif({oralTotal} > {writtenTotal}, 'Orator', 'Writer')))", "includeIntoResult": true },

    { "name": "yearsNonENTotal", "expression": "sumInArray({passions}, 'passion_years_nonEN_total')", "includeIntoResult": true },
    { "name": "familyYearsNonENTotal", "expression": "sumInArray({passions}, 'passion_family_years_nonEN')", "includeIntoResult": true },
    { "name": "maxContextYearsNonEN", "expression": "maxInArray({passions}, 'passion_max_ctx_years_nonEN')", "includeIntoResult": true },
    { "name": "nonENContextCount", "expression": "sumInArray({passions}, 'passion_nonEN_context_count')", "includeIntoResult": true },
    { "name": "nonENLangEntries", "expression": "sumInArray({passions}, 'passion_nonEN_lang_entries')", "includeIntoResult": true },
    { "name": "enLangEntries", "expression": "sumInArray({passions}, 'passion_EN_lang_count')", "includeIntoResult": true },
    { "name": "contextsOver5Count", "expression": "sumInArray({passions}, 'passion_contexts_over5_count')", "includeIntoResult": true },

    {
      "name": "profileKey",
      "expression": "iif(({nonENLangEntries} < 1) or ({enLangEntries} < 1 and {nonENLangEntries} < 2), 'MONO_EN', iif({familyYearsNonENTotal} >= ({age} * 0.75), 'BIL_HERITAGE', iif({nonENLangEntries} >= 2 and {nonENContextCount} >= 2 and {yearsNonENTotal} >= ({age} * 0.5), 'PLURILINGUAL', iif({maxContextYearsNonEN} >= ({age} * 0.5), 'BIL_ACQUIRED', iif({maxContextYearsNonEN} <= 5, 'BIL_BECOMING', 'BIL_MODERATE')))))",
      "includeIntoResult": true
    },

    {
      "name": "profileTitle",
      "expression": "iif({profileKey}='MONO_EN','English speaker (Monolingual)', iif({profileKey}='BIL_HERITAGE','Bilingual (Heritage)', iif({profileKey}='PLURILINGUAL','Plurilingual', iif({profileKey}='BIL_ACQUIRED','Bilingual (Acquired)', iif({profileKey}='BIL_BECOMING','Bilingual in becoming','Bilingual (moderate exposure)')))))",
      "includeIntoResult": true
    },
    {
      "name": "profileDescription",
      "expression": "iif({profileKey}='MONO_EN','You did not specify enough other languages to consider a bilingual profile. Try again!', iif({profileKey}='BIL_HERITAGE','You have been surrounded by other language speakers (French or any other you mentioned) and that is a great help to improve. Keep trying new activities with friends and family!', iif({profileKey}='PLURILINGUAL','You have learned to switch codes with many languages in various contexts. Congratulations! Do not underestimate your knowledge and find creative ways to use these linguistic skills.', iif({profileKey}='BIL_ACQUIRED','You have practiced this language a lot in a work or school environment, like a disciplined student. You may notice cultural variations depending on the contexts, but you can trust your solid grammar foundations to learn more.', iif({profileKey}='BIL_BECOMING','You started recently to learn this language and you might not see how to progress or use it more. Try involving French or any other language in your passions, and keep up the good work in class. You will progress faster than you think!', 'You have some regular exposure to another language, but not enough sustained use in one context to reach the stronger bilingual profiles yet.')))))",
      "includeIntoResult": true
    },
    {
      "name": "profileImageUrl",
      "expression": "iif({profileKey}='MONO_EN','https://YOUR_DOMAIN/images/profile_mono.png', iif({profileKey}='BIL_HERITAGE','https://YOUR_DOMAIN/images/profile_heritage.png', iif({profileKey}='PLURILINGUAL','https://YOUR_DOMAIN/images/profile_pluri.png', iif({profileKey}='BIL_ACQUIRED','https://YOUR_DOMAIN/images/profile_acquired.png', iif({profileKey}='BIL_BECOMING','https://YOUR_DOMAIN/images/profile_becoming.png','https://YOUR_DOMAIN/images/profile_moderate.png')))))",
      "includeIntoResult": true
    },
    { "name": "profile", "expression": "{profileTitle} + ': ' + {profileDescription}", "includeIntoResult": true }
  ]
}
  </script>
</body>
</html>
